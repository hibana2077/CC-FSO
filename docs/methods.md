# 《黎曼流形上的超細粒度視覺分類：曲率約束的特徵空間優化理論》

## 具體作法流程

### 1. 數據預處理與增強階段
- **數據集準備**：使用UFG image dataset（Cotton80, SoyLocal, SoyGene, SoyAgeing, SoyGlobal）作為基礎數據集
- **標準增強**：對輸入圖像應用隨機水平翻轉、隨機旋轉等標準數據增強
- **實例級增強**：
  - 生成正樣本：對基礎圖像進行強增強，隨機掩碼部分像素（比例α∈[0.15,0.45]）
  - 生成正樣本：將掩碼後的圖像分成n=4個部分，隨機打亂順序
  - 負樣本：從當前批次中隨機選擇其他樣本（排除自身）
- **黎曼空間映射**：將增強後的圖像通過ViT backbone投影到初始黎曼流形M₀

### 2. 黎曼流形特徵空間構建
- **流形初始化**：使用Swin Transformer Base作為特徵提取器，將圖像映射到初始特徵空間
  ```
  {v₁, v₂, ..., vₙₚ} = fᵢfₑ(I), u = (1/Nₚ)∑ᵢ₌₀¹ vᵢ
  ```
- **黎曼度量張量構建**：
  - 計算局部坐標系下的度量張量gᵢⱼ(x)
  - 通過特徵協方差矩陣構建初始度量：g(x) = E[(u - μ)(u - μ)ᵀ] + εI
- **曲率估計**：
  - 使用Ricci曲率估計方法：κᵢⱼ = -½Δgᵢⱼ + Q(g, ∂g)
  - 計算截面曲率：K(σ) = R(X,Y,X,Y)/(g(X,X)g(Y,Y) - [g(X,Y)]²)

### 3. 曲率約束損失函數設計
- **黎曼距離計算**：
  - 使用測地線距離：d(x,y) = inf{L(γ)|γ(0)=x, γ(1)=y}
  - 近似計算：d(x,y) ≈ ||expₓ⁻¹(y)||ₓ
- **曲率感知三元組損失(CAL)**：
  ```
  L_CAL = Σ[exp(κ·d²(x_i,x_j))·1{y_i=y_j} - exp(-κ·d²(x_i,x_k))·1{y_i≠y_k} + β]
  ```
  其中κ為自適應曲率參數，滿足κ ≤ -c/Δ²（Δ為最小類間距離）
- **曲率約束優化**：
  - 引入曲率正則項：R(κ) = λ·max(0, κ + c/Δ²)
  - 總損失函數：L_total = L_CAL + γ·R(κ)

### 4. 黎曼優化算法
- **黎曼梯度計算**：
  - 將歐氏梯度∇ₓL投影到切空間：gradₓL = g⁻¹(x)∇ₓL
- **自適應步長策略**：
  - 步長ηₜ = O(1/(t·√|κ|))
  - 當|κ| > κₘₐₓ時，使用固定步長η₀
- **指數映射更新**：
  - xₜ₊₁ = expₓₜ(-ηₜ·gradₓₜL)
  - 近似計算：expₓ(v) ≈ x + v + ½Γ(x)(v,v)
- **重traction操作**：使用Cayley變換確保流形約束

### 5. 收斂性驗證與分析
- **收斂條件檢查**：
  - 驗證||gradₓL||ₓ < ε
  - 檢查曲率約束是否滿足
- **特徵空間可視化**：
  - 使用t-SNE可視化不同方法的特徵分布
  - 比較黎曼流形與歐氏空間的類間/類內距離比
- **理論驗證**：
  - 驗證泛化誤差界：R(h) ≤ R̂(h) + O(√((log N)/m) + C·κ·diam(M))
  - 測試不同曲率約束對模型性能的影響