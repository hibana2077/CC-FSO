# 實驗計劃：黎曼流形上的超細粒度視覺分類實驗設計

## 一、數據收集與預處理實驗

### 1.1 數據集收集與構建

- **數據來源**：
  - UFG image dataset (Yu et al., ICCV 2021)：從官方GitHub倉庫(https://github.com/XiaohanYu-GU/Ultra-FGVC)下載全部5個子集
  - Cotton80：80個棉花品種，每個品種6張圖像（240訓練/240測試）
  - SoyLocal：200個大豆品種，每個品種6張圖像（600訓練/600測試）
  - SoyGene：1,110個大豆基因型，共23,906張圖像（12,763訓練/11,143測試）
  - SoyAgeing：198個大豆品種在不同生長階段的圖像，共9,900張圖像（4,950訓練/4,950測試）
  - SoyGlobal：1,938個大豆品種，共11,628張圖像（5,814訓練/5,814測試）
  
- **數據預處理**：
  - 將所有圖像統一調整為448×448分辨率
  - 應用標準增強：隨機水平翻轉、隨機旋轉(±15°)、顏色抖動
  - 實例級增強：隨機掩碼(比例α∈[0.15,0.45])、圖像分塊(n=4)並隨機打亂順序
  - 對每個圖像生成2個增強視圖作為正樣本對

- **預期結果**：
  - 構建完成包含47,114張圖像的完整數據集，涵蓋3,526個超細粒度類別
  - 生成的增強樣本能有效擴充數據集，解決UFGVC中類別樣本稀少的問題
  - 實例級增強後的正樣本對將用於黎曼流形上的曲率約束對比學習

## 二、核心實驗設計

### 2.1 基本性能評估實驗

- **實驗設計**：
  - 在5個UFGVC子集上評估所提方法(Curvature-Aware Loss, CAL)
  - 比較指標：Top-1準確率、類間/類內距離比、收斂速度
  - 基線方法：ResNet-50、Swin Transformer、Mix-ViT、CLE-ViT
  - 每個實驗重複5次，報告平均結果和標準差

- **數據收集**：
  - 記錄每個epoch的訓練損失、驗證準確率
  - 收集最終模型在測試集上的分類結果
  - 提取特徵空間中每類的中心點和類內方差
  - 計算黎曼流形的曲率分佈和特徵空間的幾何特性

- **預期結果**：
  - 在SoyGlobal數據集上達到至少77.5%的Top-1準確率（比Mix-ViT高1.5%）
  - 在SoyAgeing數據集上達到83.5%以上的平均準確率（比Mix-ViT高1.2%）
  - 類間/類內距離比提高20%以上，證明曲率約束有效增強了特徵區分性
  - 收斂速度比傳統對比學習方法快15-20%，驗證黎曼優化的有效性

### 2.2 消融實驗

- **實驗設計**：
  - **曲率約束消融**：測試不同曲率約束強度(κ = {-∞, -0.5, -0.1, 0, 0.1, 0.5})的影響
  - **黎曼優化消融**：比較黎曼優化與歐氏優化的性能差異
  - **損失函數組合**：測試CAL與交叉熵、三元組損失等的組合效果
  - **曲率估計方法**：比較Ricci曲率、截面曲率等不同曲率估計方法的效果

- **數據收集**：
  - 記錄不同配置下的分類準確率和收斂速度
  - 收集不同曲率約束下的特徵空間幾何特性
  - 計算不同配置下特徵流形的平均曲率和曲率方差
  - 記錄黎曼距離與歐氏距離的分佈差異

- **預期結果**：
  - 負曲率(κ < 0)的配置將顯著優於非負曲率配置，驗證理論推導
  - 當κ ≈ -0.1時達到最佳性能，符合"κ ≤ -c/Δ²"的理論約束
  - 黎曼優化將比歐氏優化提高2-3%的分類準確率，尤其在小樣本數據集(SoyLocal, Cotton80)上
  - 曲率約束項對整體性能貢獻約1.5-2.5%，證明其理論價值

### 2.3 理論驗證實驗

- **實驗設計**：
  - **曲率-性能關係**：系統性改變曲率約束參數，驗證與分類性能的關係
  - **收斂性驗證**：記錄不同曲率下算法的收斂過程，驗證O(1/√T)收斂率
  - **泛化誤差界驗證**：比較理論泛化誤差界與實際泛化誤差
  - **曲率閾值驗證**：驗證理論推導的曲率閾值κ ≤ -c/Δ²的有效性

- **數據收集**：
  - 系統性收集不同曲率約束下的性能數據
  - 記錄每個epoch的訓練損失和驗證損失，計算泛化間隙
  - 測量特徵空間的直徑diam(M)和覆蓋數
  - 計算不同曲率下特徵流形的幾何不變量

- **預期結果**：
  - 分類性能與曲率參數呈U型關係，驗證理論預測
  - 實驗收斂曲線將符合O(1/√T)的理論收斂率，優於基線方法的O(1/T^α)
  - 理論泛化誤差界與實際誤差的差距不超過5%，驗證泛化誤差界的緊緻性
  - 當曲率超過理論閾值(κ > -c/Δ²)時，性能急劇下降，驗證理論閾值的有效性

### 2.4 參數敏感性實驗

- **實驗設計**：
  - **曲率自適應參數**：測試不同c值(0.1, 0.5, 1.0, 2.0, 5.0)對性能的影響
  - **掩碼比例**：測試不同掩碼比例α∈[0.05, 0.5]對黎曼特徵學習的影響
  - **自適應步長參數**：測試不同步長參數(η₀ = 0.001, 0.005, 0.01, 0.05)的效果
  - **批量大小**：測試不同批量大小(8, 16, 32, 64)對黎曼優化的影響

- **數據收集**：
  - 記錄不同參數配置下的最終性能和收斂過程
  - 收集不同參數下特徵空間的類間/類內距離比
  - 計算不同配置下黎曼流形的曲率分佈特性
  - 記錄不同參數對訓練穩定性的影響

- **預期結果**：
  - c = 1.0時達到最佳性能，驗證理論推導的合理性
  - 掩碼比例α = 0.3時性能最佳，平衡了局部信息保留和數據多樣性
  - 自適應步長策略將在η₀ = 0.005時表現最佳，符合理論推導
  - 批量大小為16時達到最佳平衡，過大或過小都會降低性能

### 2.5 與現有方法的對比實驗
- **實驗設計**：
  - 與17種現有方法進行全面對比，包括：
    - 傳統CNN：ResNet-50, VGG-16
    - 細粒度方法：DCL, MaskCOV, SPARE
    - 對比學習方法：SimCLR, MoCo v2, BYOL
    - Transformer方法：ViT, DeiT, TransFG, Mix-ViT, CLE-ViT
  - 在5個UFGVC子集上進行公平比較
  - 額外測試在CUB-200-2011和Apple Foliar disease數據集上的遷移性能

- **數據收集**：
  - 從官方代碼庫復現所有基線方法
  - 使用相同數據增強和訓練設置確保公平比較
  - 記錄每種方法的訓練時間、推理時間和內存消耗
  - 收集每種方法的特徵空間幾何特性

- **預期結果**：
  - 在SoyGlobal數據集上達到77.5%以上的Top-1準確率，領先現有方法至少2%
  - 在SoyAgeing數據集上達到83.5%以上的平均準確率，超越Mix-ViT約1.2%
  - 在小樣本數據集(Cotton80, SoyLocal)上性能提升更為顯著(3-5%)
  - 計算效率與Mix-ViT相當，證明理論創新不增加計算複雜度

### 2.6 特徵可視化與分析實驗
- **實驗設計**：
  - 使用t-SNE和UMAP可視化不同方法的特徵分布
  - 比較黎曼特徵空間與歐氏特徵空間的幾何差異
  - 分析不同曲率約束下特徵空間的結構變化
  - 可視化分類激活圖(CAM)，分析模型關注區域

- **數據收集**：
  - 從測試集中隨機選擇10個類別，每類10個樣本
  - 提取這些樣本的特徵向量用於可視化
  - 計算可視化空間中的類間/類內距離
  - 生成分類激活圖，分析模型關注區域

- **預期結果**：
  - 可視化結果顯示CAL方法的特徵空間具有明顯的負曲率特性
  - 類間距離明顯大於類內距離，且類內樣本分布更為分散
  - 與基線方法相比，CAL方法的特徵分布更符合"曲率約束"理論
  - 分類激活圖顯示模型能夠關注更具區分性的局部區域

### 2.7 曲率動態變化實驗
- **實驗設計**：
  - 跟蹤訓練過程中特徵流形曲率的動態變化
  - 分析不同訓練階段曲率與性能的關係
  - 測試動態調整曲率約束的策略效果
  - 比較不同網絡深度對曲率演化的影響

- **數據收集**：
  - 每10個epoch記錄一次特徵流形的平均曲率
  - 記錄每個階段的訓練損失和驗證準確率
  - 收集不同網絡層的曲率分佈特性
  - 測試動態曲率調整策略的性能

- **預期結果**：
  - 訓練初期曲率較大(負值較小)，隨著訓練進行曲率逐漸減小(負值增大)
  - 曲率變化與性能提升呈正相關，驗證曲率約束的有效性
  - 動態調整曲率約束將比固定曲率提升0.8-1.2%的性能
  - 深層網絡的曲率變化更為顯著，表明幾何特性在深層表示中更為重要

## 三、數據分析與理論驗證

### 3.1 數據分析方法
- **幾何特性分析**：
  - 計算特徵流形的Ricci曲率、截面曲率和數量曲率
  - 估計特徵流形的直徑和覆蓋數
  - 分析特徵空間的測地線結構

- **統計驗證**：
  - 進行t檢驗驗證性能提升的統計顯著性(p<0.01)
  - 計算不同方法間的性能差異置信區間
  - 分析曲率參數與性能的相關係數

### 3.2 理論驗證指標
- **收斂性驗證**：
  - 擬合收斂曲線，驗證是否符合O(1/√T)理論
  - 計算收斂速率常數，與理論預測比較

- **泛化誤差界驗證**：
  - 計算理論泛化誤差界與實際誤差的差距
  - 驗證誤差界隨曲率變化的一致性
  - 測試不同數據集規模下誤差界的緊緻性

## 四、預期綜合結果

1. **理論貢獻驗證**：
   - 實驗將驗證"曲率約束理論"的有效性，證明當κ ≤ -c/Δ²時，特徵空間能實現最優分離
   - 收斂性實驗將驗證O(1/√T)的收斂率，優於傳統方法
   - 泛化誤差界實驗將證明負曲率流形能有效降低泛化誤差

2. **性能提升**：
   - 在SoyGlobal數據集上達到77.5%以上的Top-1準確率
   - 在SoyAgeing數據集上達到83.5%以上的平均準確率
   - 在小樣本數據集(Cotton80, SoyLocal)上提升3-5%的性能

3. **幾何特性驗證**：
   - 可視化結果將直觀展示負曲率特徵空間的優勢
   - 類間/類內距離比將提高20%以上
   - 曲率與分類性能的U型關係將得到驗證

4. **實用價值**：
   - 證明黎曼幾何框架能有效解決UFGVC中的極小類間差異問題
   - 提供嚴格的數學理論支持，為未來研究奠定基礎
   - 方法具有良好的計算效率，不增加額外計算複雜度
